{% load static %}

<!DOCTYPE html>
<html lang="kr">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colrolib Templates">
    <meta name="author" content="Colrolib">
    <meta name="keywords" content="Colrolib Templates">

    <!-- Title Page-->
    <title>선주교신 검색 시스템</title>


    <!-- Icons font CSS-->
    <link href="{% static 'search/vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet"
          media="all">
    <link href="{% static 'search/vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="{% static 'search/vendor/select2/select2.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'search/vendor/datepicker/daterangepicker.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'search/css/main.css' %}" rel="stylesheet" media="all">


    <link rel="stylesheet" href="https://cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.css"/>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
{#    <script>#}
{#        jQuery(function ($) {#}
{#            $("#result-table").DataTable({#}
{#                // 표시 건수기능 숨기기#}
{#                lengthChange: true,#}
{#                // 검색 기능 숨기기#}
{#                searching: false,#}
{#                // 정렬 기능 숨기기#}
{#                ordering: true,#}
{#                // 정보 표시 숨기기#}
{#                info: true,#}
{#                // 페이징 기능 숨기기#}
{#                paging: true#}
{#            });#}
{#        });#}
{#    </script>#}

<script>
    /* Formatting function for row details - modify as you need */
function format ( d ) {
    // `d` is the original data object for the row
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
        '<tr>'+
            '<td>Full name:</td>'+
            '<td>'+d.name+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Extension number:</td>'+
            '<td>'+d.extn+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Extra info:</td>'+
            '<td>And any further details here (images etc)...</td>'+
        '</tr>'+
    '</table>';
}


$(document).ready(function() {
        $.ajax({
            method: "GET",
            url: 'result',
            data: {'keyword': keyword},
            beforeSend: function () {
                $('.wrap-loading').removeClass('display-none');
            },
            complete: function () {
                //통신이 완료된 후 처리되는 함수
                $('.wrap-loading').addClass('display-none');
            },
            success: function (result) {
                if (result === "") {
                    alert(' 죄송합니다. \n 해당 검색어로는 result 결과물이 없습니다! \n 다른 검색어로 검색해주세요');
                } else {
                    $('#result_div').append(
                        "<table id=\"result_table\" class=\"display\" style=\"width:100%\">\n" +
                        "            <thead>\n" +
                        "            <tr>\n" +
                        "                <th></th>\n" +
                        "                <th>patent_id</th>\n" +
                        "                <th>title</th>\n" +
                        "                <th>country</th>\n" +
                        "                <th>date</th>\n" +
                        "                <th>site</th>\n" +
                        "            </tr>\n" +
                        "            </thead>\n" +
                        "            <tfoot>\n" +
                        "            <tr>\n" +
                        "                <th></th>\n" +
                        "                <th>patent_id</th>\n" +
                        "                <th>title</th>\n" +
                        "                <th>country</th>\n" +
                        "                <th>date</th>\n" +
                        "                <th>site</th>\n" +
                        "            </tr>\n" +
                        "            </tfoot>\n" +
                        "        </table>"
                    );

                    var dt = $('#result_table').DataTable({
                        data: result['data_list'],
                        columns: [
                            {
                                "class": "details-control",
                                "orderable": false,
                                "data": null,
                                "defaultContent": ""
                            },
                            {data: 'patent_id'},
                            {data: 'title'},
                            {data: 'country'},
                            {data: 'date'},
                            {
                                data: "country",
                                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                                    $(nTd).html("<a target='_blank' href='http://patents.google.com/patent/" + oData.country + oData.number + oData.kind + "'>Info</a>");
                                }
                            }
                        ],
                        "order": [[4, 'desc']]
                    });

                    // Array to track the ids of the details displayed rows
                    var detailRows = [];
                    $('#result_table tbody').on('click', 'tr td.details-control', function () {
                        var tr = $(this).closest('tr');
                        var row = dt.row(tr);
                        var idx = $.inArray(tr.attr('id'), detailRows);

                        if (row.child.isShown()) {
                            tr.removeClass('details');
                            row.child.hide();

                            // Remove from the 'open' array
                            detailRows.splice(idx, 1);
                        } else {
                            tr.addClass('details');
                            row.child(format(row.data())).show();

                            // Add to the 'open' array
                            if (idx === -1) {
                                detailRows.push(tr.attr('id'));
                            }
                        }
                    });

                    // On each draw, loop over the `detailRows` array and show any child rows

                    dt.on('draw', function () {
                        $.each(detailRows, function (i, id) {
                            $('#' + id + ' td.details-control').trigger('click');
                        });
                    });


                    {#$(document).ready(function () {#}
                    {#    /* Column별 검색기능 추가 */#}
                    {#    $('#result_table_filter').prepend('<select id="select"></select>');#}
                    {#    $('#result_table > thead > tr').children().each(function (indexInArray, valueOfElement) {#}
                    {#        if (indexInArray == 0 | indexInArray == 5) {#}
                    {#        } else {#}
                    {#            $('#select').append('<option>' + valueOfElement.innerHTML + '</option>');#}
                    {#        }#}
                    {#    });#}
                    {##}
                    {#    $('.dataTables_filter input').unbind().bind('keyup', function () {#}
                    {#        var colIndex = document.querySelector('#select').selectedIndex + 1;#}
                    {#        dt.column(colIndex).search(this.value).draw();#}
                    {#    });#}
                    {##}
                    {#});#}

                    var offset = $("#result_section").offset();
                    $('html, body').animate({scrollTop: offset.top}, 400);

                }
            }
        })
});

$(document).ready(function() {
    var table = $('#example').DataTable( {
        "ajax": "../ajax/data/objects.txt",
        "columns": [
            {
                "className":      'details-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            },
            { "data": "name" },
            { "data": "position" },
            { "data": "office" },
            { "data": "salary" }
        ],
        "order": [[1, 'asc']]
    } );

    // Add event listener for opening and closing details
    $('#example tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );

        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );
} );
</script>


    <style>
        td.details-control {
    background: url('../resources/details_open.png') no-repeat center center;
    cursor: pointer;
}
tr.shown td.details-control {
    background: url('../resources/details_close.png') no-repeat center center;
}
    </style>
</head>

<body>

<div class="page-wrapper bg-img-1 p-t-100 p-b-60">
    <div class="wrapper wrapper--w900">
        <div class="title">
            <a href="{% url 'home' %}">
                <img src="{% static 'search/images/DSME_logo.png' %}" width="250px" alt="DSME-logo">
            </a>
        </div>
        <div class="card card-4">
            <div class="card-body">

                <ul class="tab-list">
                    <li class="tab-list__item active">
                        <a class="tab-list__link" data-toggle="tab">검색결과</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="title">
                        {% for data in data_list %}
                            {{ data }}
                        {% endfor %}
                    </div>

                <table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Position</th>
                <th>Office</th>
                <th>Salary</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Position</th>
                <th>Office</th>
                <th>Salary</th>
            </tr>
        </tfoot>
    </table>

                    {#                    <table id="result-table" class="table table-bordered table-white">#}
                    {#                        <thead>#}
                    {#                        <tr>#}
                    {#                            <th>No</th>#}
                    {#                            <th>지역선택</th>#}
                    {#                        </tr>#}
                    {#                        </thead>#}
                    {#                        <tbody>#}
                    {#                        <tr>#}
                    {#                            <td>1</td>#}
                    {#                            <td>서울</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>2</td>#}
                    {#                            <td>경기도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>3</td>#}
                    {#                            <td>충청남도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>4</td>#}
                    {#                            <td>충청북도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>5</td>#}
                    {#                            <td>전라남도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>6</td>#}
                    {#                            <td>전라북도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>7</td>#}
                    {#                            <td>경상남도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>8</td>#}
                    {#                            <td>경상북도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>9</td>#}
                    {#                            <td>강원도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>10</td>#}
                    {#                            <td>제주도</td>#}
                    {#                        </tr>#}
                    {#                        <tr>#}
                    {#                            <td>99</td>#}
                    {#                            <td>해외</td>#}
                    {#                        </tr>#}
                    {#                        </tbody>#}
                    {#                    </table>#}

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Jquery JS-->
<script src="{% static 'search/vendor/jquery/jquery.min.js' %}"></script>
<!-- Vendor JS-->
<script src="{% static 'search/vendor/select2/select2.min.js' %}"></script>
<script src="{% static 'search/vendor/jquery-validate/jquery.validate.min.js' %}"></script>
<script src="{% static 'search/vendor/bootstrap-wizard/bootstrap.min.js' %}"></script>
<script src="{% static 'search/vendor/bootstrap-wizard/jquery.bootstrap.wizard.min.js' %}"></script>
<script src="{% static 'search/vendor/datepicker/moment.min.js' %}"></script>
<script src="{% static 'search/vendor/datepicker/daterangepicker.js' %}"></script>

<!-- Main JS-->
<script src="{% static 'search/js/global.js' %}"></script>


</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->
